<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Butcher: Network Butcher</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Network Butcher
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Just a normal butcher. A network butcher</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Network Butcher </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a>The objective of this project is to develop a C++20 library that can find, given a Deep Neural Network in Onnx format, the K optimal ways of partitioning it in order to minimize the overall execution time of the model itself on multiple devices. Currently, the library can only be compiled as a static library.</p>
<p>The documentation can be manually generated by using Doxygen (as presented below) or by accessing it through <a href="https://faccus.github.io/network_butcher/">GitHub Pages</a>.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Project structure</h2>
<p>The project is structured into four main directories:</p>
<ul>
<li>include/network_butcher: It contains all the header files of the library. A <a class="el" href="md_include_network_butcher_README.html">README</a> file describing its contents is also available.</li>
<li>src: It contains all the source files of the library. Moreover, in the CMakeList file, all the external libraries used by the library are imported (except GoogleTest and Doxygen). A <a class="el" href="md_src_README.html">README</a> file describing its contents is also available.</li>
<li>google_tests: It contains all the source files of the tests. Each source file contains a brief description of the purposes of the associated test suit, while, before each test, a small comment on its purpose is present.</li>
<li>mains: It contains both a collection of main files to test the performances of the program and the basic main file that allows to perform the partitioning directly from command-line. A <a class="el" href="md_mains_README.html">README</a> file describing its contents is also available.</li>
</ul>
<p>The other directories are:</p>
<ul>
<li>dep: It contains the external libraries (currently, only aMLLibrary). They are stored as submodules.</li>
<li>doc: It contains the CMakeLists.txt file with the options used to generate the documentation</li>
<li>scripts: It contains some extra scripts to modify an .onnx file to add shapes to all the tensors (it must be executed for a new .onnx model, unless shapes were already inferred). Moreover, the notebooks used to create the plots of the measured performances are also present (as well as the actual results)</li>
<li>test_data: It contains the files used during testing (models, sample configuration files and sample weight files). A <a class="el" href="md_test_data_README.html">README</a> file describing its contents is also available.</li>
</ul>
<p>To easily start reading the project, we think it's best to start from the <a class="el" href="general__manager_8h.html">general_manager.h</a> header file.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Requirements:</h2>
<ul>
<li>CMake version 3.21 (or higher). Required to configure and compile the code. Must be installed by the user</li>
<li>g++ version 8 (or higher). Required to compile the code. Must be installed the user</li>
<li><a href="https://github.com/protocolbuffers/protobuf/tree/v21.12">Protobuf v3.21.12</a> (Required). This library may be manually installed and linked against our library by checking the appropriate option in the CMakeLists.txt file</li>
<li><a href="https://github.com/google/googletest/releases/tag/release-1.12.1">Google Tests v1.12.1</a> (Optional). It is automatically downloaded by CMake if tests are enabled in the CMakeLists.txt file</li>
<li><a href="https://github.com/doxygen/doxygen/releases/tag/Release_1_9_3">Doxygen v1.9.3 or higher</a> (Optional). It must be manually installed (with its dependencies: Graphviz, dia and mscgen)</li>
</ul>
<p>The weight generation may be automatically performed if a compatible model is provided. This, however, adds some extra requirements:</p>
<ul>
<li><a href="https://github.com/pybind/pybind11/releases/tag/v2.10.3">PyBind v2.10.3</a>. The library will be automatically downloaded and compiled by CMake. However, it requires Python3 and pip to be installed.</li>
<li><a href="https://github.com/brunoguindani/aMLLibrary/tree/933be8b094ca468d4813fe0c837fc6d46cc608d2">aMLLibrary</a> (Python github project). A local version of the package is already available (as a submodule) in the dep directory. Since the package is still work in progress, we chose a specific commit. For an explanation on why it is employed and a quick tutorial on its usage, please refer to the <a class="el" href="md_test_data_aMLLibrary_data_README.html">README</a> file. To install all of its package dependencies, simply call in our repository root directory: <div class="fragment"><div class="line">python3 -m pip install -r dep/aMLLibrary/requirements.txt</div>
</div><!-- fragment --></li>
<li><a href="https://github.com/ThanatosShinji/onnx-tool">Onnx-Tool v0.6.1</a> (Python Package). To install it, simply call: <div class="fragment"><div class="line">python3 -m pip install onnx-tool==0.6.1</div>
</div><!-- fragment --></li>
</ul>
<p>The CMakeLists.txt file exposes some options that may be changed to avoid the usage of some of the previously cited libraries.</p>
<p>Parallelism can be enabled by checking the proper option in the CMakeLists.txt file. Parallelism may be used with either:</p>
<ul>
<li><a href="https://www.openmp.org/">OpenMP v4.5</a>. Since we do not fix the number of parallel threads that the library can use directly in the code, we advise setting the environment variable OMP_NUM_THREADS to the desired number of threads.</li>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onetbb.html">Intel TBB v2021.5.0</a>. In particular, this library is used to allow parallelism through the 'execution' standard library header file. In this case, the number of threads can only be fixed manually in the code. By default, it will run using the maximum number of threads.</li>
</ul>
<p>We advise, if undecided on which library to use, to employ OpenMP, since it is easier to install and use.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Requirements Quick Install (Linux only)</h2>
<p>We here report a small collection of simple bash commands to install the required libraries on a Linux system:</p><ul>
<li>Compiler, CMake and Doxygen (with its extra packages): <div class="fragment"><div class="line">sudo apt-get update &amp;&amp; sudo apt-get install build-essential cmake doxygen graphviz dia mscgen -y</div>
</div><!-- fragment --></li>
<li>Python, pip, aMLLibrary requirements and onnx-tool: <div class="fragment"><div class="line">sudo apt-get install python3-dev python3-pip --no-install-recommends -y</div>
</div><!-- fragment --> <div class="fragment"><div class="line">python3 -m pip install -r requirements.txt</div>
</div><!-- fragment --> <div class="fragment"><div class="line">python3 -m pip install onnx-tool==0.6.1</div>
</div><!-- fragment --></li>
<li>OpenMP and TBB: <div class="fragment"><div class="line">sudo apt-get install libomp-14-dev libtbb-dev -y</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Docker</h2>
<p>A Dockerfile is available to speed up the initial setup. The file contains all the required dependencies to run each component of the library.</p>
<p>To build the image, after having cloned the project, simply run from the project directory: </p><div class="fragment"><div class="line">docker build -t network_butcher .</div>
</div><!-- fragment --><p>To run the container and enter the bash shell, run: </p><div class="fragment"><div class="line">docker run --name nn --rm -v $(pwd):/network_butcher -it network_butcher</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Project setup:</h2>
<ol type="1">
<li>Clone the repository:</li>
</ol>
<div class="fragment"><div class="line">git clone https://github.com/faccus/network_butcher --recurse-submodules</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">git clone git@github.com:faccus/network_butcher.git --recurse-submodules</div>
</div><!-- fragment --><ol type="1">
<li>Create the build directory and move there:</li>
</ol>
<div class="fragment"><div class="line">cd network_butcher</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
</div><!-- fragment --><ol type="1">
<li>Prepare the directory for the build: <div class="fragment"><div class="line">cmake -DCMAKE_BUILD_TYPE=Release -S .. -B . -DBUILD_PROTOBUF_SOURCE=ON -DUSE_GOOGLETEST=ON -DDISCOVER_COMPLETE_TESTS=ON -DENABLE_NETWORK_BUTCHER_PARALLEL=OFF -DUSE_OPENMP=ON -DUSE_PYBIND=OFF -DBUILD_DOC=OFF</div>
</div><!-- fragment --> You can customize the command by changing to ON/OFF the various options. If you prefer to edit manually the file, you can edit the options in the CMakeLists.txt file in the root directory of the repository and, then, call, in the build directory: <div class="fragment"><div class="line">cmake -DCMAKE_BUILD_TYPE=Release -S .. -B . </div>
</div><!-- fragment --> Notice that, during this phase, if USE_PYBIND=ON, CMake will create a header file in the src directory (of the build), in order to have the path to the aMLLibrary package.</li>
</ol>
<h3><a class="anchor" id="autotoc_md17"></a>
Build Options</h3>
<p>Once the directory is prepared for the build, you can request CMake to compile several possible targets, detailed in the next subsections. The general procedure to compile any target is simple, since you just need to call: </p><div class="fragment"><div class="line">cmake --build . --target TARGET_TO_COMPILE</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
network_butcher</h3>
<p>If <a class="el" href="namespacenetwork__butcher.html">network_butcher</a> is chosen as the target, CMake will compile and output in the src directory of the build the (static) library</p>
<h3><a class="anchor" id="autotoc_md19"></a>
main</h3>
<p>If main is chosen as the target, CMake will compile <a class="el" href="namespacenetwork__butcher.html">network_butcher</a> and, using the main.cpp file contained in mains, it will generate a simple executable, called main: it will read from the command line the path to a configuration file (sample configuration files are reported in test_data/configs) and perform the partitioning of the provided model. A help message will be printed if the command is not recognized.</p>
<div class="fragment"><div class="line">./main config_file=path/to/config</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md20"></a>
Profiling mains</h3>
<p>To properly verify the performances of the associated library, we decided to make available a collection of main files to properly measure the time required to perform each phase of the "butchering". They can be easily compiled by calling in the configured build directory:</p>
<div class="fragment"><div class="line">cmake --build . --target main_Constrained_Builder</div>
<div class="line">cmake --build . --target main_IO_Manager</div>
<div class="line">cmake --build . --target main_kfinder</div>
<div class="line">cmake --build . --target main_path_reconstruction</div>
<div class="line">cmake --build . --target main_synthetic_graph</div>
</div><!-- fragment --><p>For more details on what do they do, check the following <a class="el" href="md_mains_README.html">README</a> file.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Doxygen</h3>
<p>To run doxygen and generate the documentation, you can just call from the build directory: </p><div class="fragment"><div class="line">cmake --build . --target doxygen</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md22"></a>
Tests</h3>
<p>Optionally, if the appropriate option was chosen during the initial configuration, the tests can be built by using the following command: </p><div class="fragment"><div class="line">cmake --build . --target test_run</div>
</div><!-- fragment --><p>and executed by:</p>
<div class="fragment"><div class="line">./test_run</div>
</div><!-- fragment --><p>By changing the target to 'test_run_complete' a longer collection of tests will be executed. This is useful to check the correctness of the program, but it may take a while to complete. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
